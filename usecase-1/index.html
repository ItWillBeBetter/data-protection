


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Workshop and sample code that builders can use for experiential learning of AWS services that provide data protection. Services such as AWS KMS, AWS ACM, Amazon Macie, AWS CloudHSM and others will be explored">
      
      
        <link rel="canonical" href="https://data-protection.awssecworkshops.com/usecase-1/">
      
      
        <meta name="author" content="aws-security-workshops@amazon.com">
      
      <link rel="shortcut icon" href="../assets/images/aws-favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.6">
    
    
      
        <title>Index - Data Protection on AWS</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.63b94e9e.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../stylesheets/custom.css">
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#server-side-encryption" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://data-protection.awssecworkshops.com" title="Data Protection on AWS" class="md-header-nav__button md-logo" aria-label="Data Protection on AWS">
      
  <img src="../assets/images/aws_smile_logo.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Data Protection on AWS
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Index
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/aws-samples/data-protection/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aws-samples/data-protection
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://data-protection.awssecworkshops.com" title="Data Protection on AWS" class="md-nav__button md-logo" aria-label="Data Protection on AWS">
      
  <img src="../assets/images/aws_smile_logo.png" alt="logo">

    </a>
    Data Protection on AWS
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/aws-samples/data-protection/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aws-samples/data-protection
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../contribute/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/aws-samples/data-protection/edit/master/docs/usecase-1/README.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h2 id="server-side-encryption">Server Side Encryption</h2>
<h1 id="prerequisites">Prerequisites</h1>
<h3 id="aws-account">AWS Account</h3>
<p>If you are participating in this workshop as part of an AWS event, pre-provisioned temporary accounts that are specifically initialized for this workshop might be provided by the organizers. To access your temporary account you will receive a <strong>12-digit hash code</strong> that can be used at the <a href="https://dashboard.eventengine.run">AWS Event Engine Site</a>. You will not need a username and password.</p>
<p>If you wish to participate in this workshop without a pre-provisioned temporary account, please see the <a href="#aws-initialization-tear-down">AWS Initialization and tear down</a> section below.</p>
<h3 id="browser">Browser</h3>
<p>These workshops assume that you are using the <a href="https://aws.amazon.com/cloud9/">Cloud9 IDE environment</a>. We recommend you use the latest version of Chrome or Firefox to complete this workshop. </p>
<h3 id="knowledge-of-python-programming-language">Knowledge Of Python Programming Language</h3>
<p>Basic python knowledge is sufficient to consume these workshops.</p>
<h1 id="setup-workshop-environment">Setup Workshop Environment</h1>
<ul>
<li>Navigate to the Cloud9 service within your AWS console</li>
<li>Open the Cloud9 IDE environment called <strong>workshop-environment</strong>. It takes about 30 seconds for the environment to start up.</li>
<li>In the Cloud9 IDE environment you will find a folder called <strong>data-protection</strong> in the folder pane on the left side of the screen</li>
<li>Right-click (on MacOS: control-click) the file named <strong>environment-setup.sh</strong>  in the IDE and select <strong>Run</strong></li>
<li>This script takes about a minute to complete</li>
<li>In the runner window below you should see <strong>SUCCESS: installed python dependencies </strong> followed by a list of the installed packages</li>
</ul>
<h1 id="aws-initialization-tear-down">AWS Initialization &amp; tear down</h1>
<p><strong>IMPORTANT!</strong> 
* This section is only relevant if you are <strong>not</strong> using a pre-provisioned account. 
* The resources used in this workshop <strong>will incur charges</strong> in the AWS account used if not torn down according to the procedure outlined below</p>
<p>You can use a <strong>personal account</strong> or create a <strong>new AWS account</strong> to ensure you have the neccessary access. This should not be an AWS account from the company you work for. Please note that creating an AWS account takes time (credit card validation, etc.) and is not recommended when participating in the workshop during a time constrained event.</p>
<h3 id="region-support">Region Support</h3>
<p>Since these workshops use the Cloud9 IDE, you can use run these workshops in the following regions where the AWS Cloud9 
service is available : 
* <strong>N.Virginia</strong> (us-east-1)
* <strong>Ohio</strong> (us-east-2)
* <strong>Oregon</strong> (us-west-2)
* <strong>Ireland</strong> (eu-west-1)
* <strong>Singapore</strong> (ap-southeast-1)</p>
<h3 id="cloudformation-templates-for-initial-environment-setup">Cloudformation templates for initial environment setup</h3>
<p>Please download the <a href="cf-templates/template-workshops-setup.yaml">Data Protection Workshop cloudformation stack</a> and launch it in your AWS account as this is required for all the workshops in this repository. To launch the stack you must go to the AWS Console and navigate to the CloudFormation service where you can choose <strong>Create Stack</strong> and upload the Cloudformation stack for the workshop. You provide a name for the stack and keep clicking <strong>next</strong> until you get to the point where it says:</p>
<div class="codehilite"><pre><span></span><code><span class="err">I acknowledge that AWS CloudFormation might create IAM resources with custom names.</span>
</code></pre></div>


<p>Acknowledge the above statement by clicking on the check box and then click on the <strong>Create</strong> button</p>
<p>The above stack creates an Cloud9 IDE environment called <strong>workshop-environment</strong>. 
In addition a VPC with two subnets and an internet gateway is also created.</p>
<p>This workshop demonstrates server side encryption using AWS KMS and S3</p>
<h2 id="lets-look-at-some-concepts">Let's look at some concepts :</h2>
<p><a><img src="images/data-at-rest-encryption-primer.png" width="700" height="500"></a><br>
<a><img src="images/server-side-encryption-in-aws.png" width="700" height="500"></a><br></p>
<h2 id="lets-do-some-server-side-encryption">Let's do some server side encryption</h2>
<p>Open the Cloud9 IDE environment called <strong>workshop-environment</strong> and navigate to the <strong>data-protection/usecase-1</strong> directory.
Follow the instructions below:</p>
<h3 id="1-run-the-module-named-kms_key_creation-step-1py">1. Run the module named <code>kms_key_creation-Step-1.py</code></h3>
<p>This module will create a KMS master key with the key alias <strong>kms_key_sse_usecase_1</strong> . In the following steps we will refer to this
master key using the alias. Browse to the KMS console and you should find the key alias <strong>kms_key_sse_usecase_1</strong> under 
customer managed keys</p>
<h3 id="2-run-the-module-named-usecase-1-step-2py">2. Run the module named <code>usecase-1-Step-2.py</code></h3>
<p>This module uploads the <strong><em>plaintext_u.txt</em></strong> file to an S3 bucket named <code>dp-workshop-builderXXXX</code>. 
Before the file is stored on S3 it is server side encrypted using the KMS key alias <em>kms_key_sse_usecase_1</em></p>
<h3 id="3-inspect-the-encrypted-file-in-s3">3. Inspect the encrypted file in S3</h3>
<p>In the AWS console, navigate to the S3 service and look for the bucket named <code>dp-workshop-builderXXXX</code>.
In the bucket there should be a file called <strong><em>encrypted_e.txt</em></strong>. This file was encrypted using a Data key under the KMS master key <strong>key_sse_usecase_1*<em>. Take a look at the properties of the file </em></strong>encrypted_e.txt***. You will find that it's encrypted using AWS-KMS as shown in the picture below:</p>
<p><a><img src="images/in-aws-console-sse.png" width="400" height="200"></a><br></p>
<h3 id="4-compare-the-decrypted-file-from-s3-with-the-original">4. Compare the decrypted file from S3 with the original</h3>
<p>The <code>usecase-1-Step-2.py</code> python module does a S3 getobject API Call on <strong><em>encrypted_e.txt</em></strong> which is decrypted by the S3 service and retrieved over TLS into your Cloud9 environment. In the folder <strong>usecase-1*<em> ,you should see a file called </em></strong>plaintext_cycled_u.txt<strong><em>. Compare its contents to the original file named </em></strong>plaintext_u.txt***. </p>
<h3 id="5-run-the-module-named-usecase-1-cleanup-step-3py">5. Run the module named <code>usecase-1-cleanup-Step-3.py</code></h3>
<p>This modules deletes the kms key and it's alias that we created in <strong>kms_key_creation-Step-1.py</strong> and also deletes all the files that were created in the <strong>usecase-1</strong> folder. Please remember that when you run <code>usecase-1-cleanup-Step-3.py</code> and you want to re-run this use case, you will have to start from the beginning.</p>
<h3 id="tear-down-cloudformation-stack">Tear down Cloudformation stack</h3>
<p>After you have completed the workshop, you need to tear down the stack by navigating to the CloudFormation service in the AWS console and selecting the stack name you chose when launching the stack. If you are doing this workshop as
part of a AWS marketing with a pre-provisioned account provided by AWS you don't have to do any teardown</p>
<p>Choose the <strong>delete</strong> action and wait for the process to complete. Note that it can take a few minutes for the stack to clean up its resources.</p>
<h2 id="license-summary">License Summary</h2>
<p>This sample code is made available under a modified MIT license. See the <a href="LICENSE">LICENSE</a> file.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            <a href="https://aws.amazon.com/privacy/" target="_blank">Privacy</a> | <a href="https://aws.amazon.com/terms/" target="_blank">Site terms</a> | &copy; 2020, Amazon Web Services, Inc. or its affiliates. All rights reserved.
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://awssecworkshops.com" target="_blank" rel="noopener" title="awssecworkshops.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M280.37 148.26L96 300.11V464a16 16 0 0016 16l112.06-.29a16 16 0 0015.92-16V368a16 16 0 0116-16h64a16 16 0 0116 16v95.64a16 16 0 0016 16.05L464 480a16 16 0 0016-16V300L295.67 148.26a12.19 12.19 0 00-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 00-12-12h-56a12 12 0 00-12 12v72.61L318.47 43a48 48 0 00-61 0L4.34 251.47a12 12 0 00-1.6 16.9l25.5 31A12 12 0 0045.15 301l235.22-193.74a12.19 12.19 0 0115.3 0L530.9 301a12 12 0 0016.9-1.6l25.5-31a12 12 0 00-1.7-16.93z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://aws.amazon.com/security/" target="_blank" rel="noopener" title="aws.amazon.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M466.5 83.7l-192-80a48.15 48.15 0 00-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/awssecurityinfo?lang=en" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://aws.amazon.com/blogs/security/" target="_blank" rel="noopener" title="aws.amazon.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M400 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V80c0-26.51-21.49-48-48-48zM112 416c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm157.533 0h-34.335c-6.011 0-11.051-4.636-11.442-10.634-5.214-80.05-69.243-143.92-149.123-149.123-5.997-.39-10.633-5.431-10.633-11.441v-34.335c0-6.535 5.468-11.777 11.994-11.425 110.546 5.974 198.997 94.536 204.964 204.964.352 6.526-4.89 11.994-11.425 11.994zm103.027 0h-34.334c-6.161 0-11.175-4.882-11.427-11.038-5.598-136.535-115.204-246.161-251.76-251.76C68.882 152.949 64 147.935 64 141.774V107.44c0-6.454 5.338-11.664 11.787-11.432 167.83 6.025 302.21 141.191 308.205 308.205.232 6.449-4.978 11.787-11.432 11.787z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.d1f5a259.min.js"></script>
      <script src="../assets/javascripts/bundle.d5fec882.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.fae956e7.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>